<head>
  <style> body { margin: 0; } </style>

  <script src="//unpkg.com/three"></script>
  <script src="//unpkg.com/dat.gui"></script> 
  <script src="//unpkg.com/three-spritetext"></script>

  <script src="//unpkg.com/3d-force-graph"></script>
  <!--<script src="../../dist/3d-force-graph.js"></script>-->
</head>

<body>
  <div id="3d-graph"></div>

  <script>
    const Graph = ForceGraph3D()
    .backgroundColor('#101020')
      (document.getElementById('3d-graph'))
        .jsonUrl('datasets/test.json')
        .nodeAutoColorBy('group')
        .nodeThreeObject(node => {
          const sprite = new SpriteText(node.id);
          sprite.material.depthWrite = false; // make sprite background transparent
          sprite.color = node.color;
          sprite.textHeight = 4;
          return sprite;
        })

        .onNodeClick(node => {
          // Aim at node from outside it
          const distance = 80;
          const distRatio = 1 + distance/Math.hypot(node.x, node.y, node.z);

          const newPos = node.x || node.y || node.z
            ? { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio }
            : { x: 0, y: 0, z: distance }; // special case if node is in (0,0,0)

          Graph.cameraPosition(
            newPos, // new position
            node, // lookAt ({ x, y, z })
            3000  // ms transition duration
          );
        });

    console.log(Graph.getGraphBbox());
    
    //Define GUI
    const Settings = function() {
      this.strength = 20;
    };

    const linkForce = Graph
      .d3Force('link')
      .distance(link => settings.strength);

    const colorParam = {
      backgroundColor: Graph.backgroundColor(),
    };

    const settings = new Settings();
    const gui = new dat.GUI();

    const controllerOne = gui.add(settings, 'strength', 0, 100);
    const controller2 = gui.addColor(colorParam, 'backgroundColor').onChange((value) => Graph.backgroundColor(value.toString()));

    controllerOne.onChange(updateLinkDistance);

    function updateLinkDistance() {
      linkForce.distance(link => settings.strength);
      Graph.numDimensions(3); // Re-heat simulation
    }

    // Spread nodes a little wider
    // Graph.d3Force('charge').strength(-1000);

    // addings ome other geometry to the scene
    // const planeGeometry = new THREE.PlaneGeometry(100000, 100000, 1, 1);
    // const planeMaterial = new THREE.MeshLambertMaterial({color: 0xFF0000, side: THREE.DoubleSide});
    // const mesh = new THREE.Mesh(planeGeometry, planeMaterial);
    // mesh.position.set(-100, -200, -100);
    // mesh.rotation.set(0.5 * Math.PI, 0, 0);

    // // Graph.scene().add(mesh);
    const geometry = new THREE.BoxGeometry( 100, 100, 100 ); 
    const material = new THREE.MeshBasicMaterial( {color: 0x00ff00} ); 
    const cube = new THREE.Mesh( geometry, material ); 
    cube.position.set(-100, -50, 0);
    cube.rotation.set(0, 0, 0);

    console.log(Graph.position.graph2ScreenCoords(1,2,3));
    Graph.scene().add(cube);

    

  </script>
</body>